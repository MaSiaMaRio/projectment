<!DOCTYPE html>
<html>
<head>
    <title>–ö–∞—Ä—Ç–∞ –ù–∞–ª—å—á–∏–∫–∞</title>
    <meta charset="utf-8" />
    <style>
        #map { height: 100vh; width: 100%; }
        .marker-icon {
            background-color: #2563eb;
            border-radius: 50%;
            width: 60%; 
            height: 60%; 
            border: 15px solid red;
            box-shadow: 0 0 15px rgba(0,0,0,0.4);
            transition: transform 0.2s;
        } 
        .leaflet-tooltip {
            font-size: 30px;
            padding: 5px 5px;
            background-color: #fff;
            border-radius: 30px;
            border: 3px solid #ccc;
            box-shadow: 0 2px 6px rgba(0,0,0,0.15);
            font-weight: 500;
        }
        .leaflet-popup-content-wrapper {
            padding: 40px;
            border-radius: 1rem;
            font-size: 30px;
            max-width: 400px;
        }
        .leaflet-popup-content {
            margin: 0;
            line-height: 1.5;
        }
        .leaflet-popup-tip {
            display: none;
        }
        .leaflet-popup-close-button {
            font-size: 45px !important;
            top: 6px;
            right: 6px;
            width: 30px;
            height: 30px;
            line-height: 30px;
        }
        .popup-btn {
            padding: 20px 30px;
            font-size: 20px;
            border-radius: 10px;
            margin: 0 6px;
            background-color: #f3f4f6;
            cursor: pointer;
        }
        .outer-circle {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background-color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 0 4px rgba(0,0,0,0.4);
        }
        .inner-circle {
            width: 60%;
            height: 60%;
            border-radius: 50%;
            background-color: #2563eb;
        }
        .user-location {
  background-color: #009900;
  border-radius: 50%;
  width: 70%;
  height: 70%;
  border: 3px solid white;
  box-shadow: 0 0 6px rgba(0, 0, 0, 0.3);
}

@keyframes fadeOut {
  from { opacity: 1; }
  to { opacity: 0; }
}

</style>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
</head>
<body>
    <div id="map"></div>
    <button id="addPointBtn" style="position: fixed; top: 20px; right: 20px; z-index: 1000; padding: 16px 24px; font-size: 40px; background-color: #2563eb; color: white; border: none; border-radius: 12px; cursor: pointer;">
        ‚ûï –î–æ–±–∞–≤–∏—Ç—å —Ç–æ—á–∫—É
    </button>
    <script src="https://unpkg.com/leaflet/dist/leaflet.js">



navigator.geolocation.getCurrentPosition(function(position) {
    const userLat = position.coords.latitude;
    const userLon = position.coords.longitude;

    const userMarker = L.marker([userLat, userLon], {
        icon: L.divIcon({
            className: 'user-location',
            iconSize: [40, 40]
        })
    }).addTo(map).bindTooltip("–í—ã –∑–¥–µ—Å—å", {permanent: true, direction: "top"});

    map.setView([userLat, userLon], 15);
});

</script>
    <script>
    function parseTelegramInitData() {
        const tg = window.Telegram?.WebApp;
        const initDataStr = tg?.initData || "";
        const params = new URLSearchParams(initDataStr);
        const userRaw = params.get("user");
        if (userRaw) {
            try {
                const userObj = JSON.parse(userRaw);
                return userObj.id;
            } catch (e) {
                return null;
            }
        }
        return null;
    }

    setTimeout(() => {
        const tg = window.Telegram?.WebApp;
        const userId = tg?.initDataUnsafe?.user?.id || parseTelegramInitData();
        if (userId) {
            fetch(`https://nalchik-map-production.up.railway.app/check_access?user_id=${userId}`)
                .then(res => res.json())
                .then(data => {
                    if (!data.access) {
                        document.body.innerHTML = "<div style='padding:40px; font-size:28px; text-align:center;'>üîí <b>–î–æ—Å—Ç—É–ø –∑–∞–∫—Ä—ã—Ç</b><br><br>–ü–æ–¥–ø–∏—à–∏—Ç–µ—Å—å —á–µ—Ä–µ–∑ Telegram-–±–æ—Ç–∞, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –∫–∞—Ä—Ç–µ.</div>";
                    }
                });
        } else {
            document.body.innerHTML = "<div style='padding:40px; font-size:28px; text-align:center;'>‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è Telegram.<br>–û—Ç–∫—Ä–æ–π—Ç–µ –∫–∞—Ä—Ç—É –∏–∑ Telegram Mini App.</div>";
        }

        const debugBox = document.createElement('div');
        debugBox.style = "position:fixed; top:0; left:0; width:100%; max-height:60vh; overflow:auto; background:white; color:black; z-index:9999; font-size:14px; padding:20px;";
        debugBox.innerText = "tg.initData: " + (tg?.initData || "–Ω–µ—Ç") + "
user.id: " + userId;
        document.body.prepend(debugBox);
    }, 100);
</script>

  <button onclick="window.location.reload()" style="position: fixed; top: 120px; right: 20px; z-index: 1000; padding: 16px 24px; font-size: 40px; background-color: #10b981; color: white; border: none; border-radius: 12px; cursor: pointer;">
    üîÑ –û–±–Ω–æ–≤–∏—Ç—å
  </button>

  <div id="statusText" style="position: fixed; top: 220px; right: 20px; z-index: 1000; font-size: 25px; color: #111; font-weight: 500; background: white; padding: 10px 14px; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); transition: opacity 1s;">
  </div>

<script>
    function parseTelegramInitData() {
        const tg = window.Telegram?.WebApp;
        const initDataStr = tg?.initData || "";
        const params = new URLSearchParams(initDataStr);
        const userRaw = params.get("user");
        if (userRaw) {
            try {
                const userObj = JSON.parse(userRaw);
                return userObj.id;
            } catch (e) {
                return null;
            }
        }
        return null;
    }

    setTimeout(() => {
        const tg = window.Telegram?.WebApp;
        const userId = tg?.initDataUnsafe?.user?.id || parseTelegramInitData();
        if (userId) {
            fetch(`https://nalchik-map-production.up.railway.app/check_access?user_id=${userId}`)
                .then(res => res.json())
                .then(data => {
                    if (!data.access) {
                        document.body.innerHTML = "<div style='padding:40px; font-size:28px; text-align:center;'>üîí <b>–î–æ—Å—Ç—É–ø –∑–∞–∫—Ä—ã—Ç</b><br><br>–ü–æ–¥–ø–∏—à–∏—Ç–µ—Å—å —á–µ—Ä–µ–∑ Telegram-–±–æ—Ç–∞, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –∫–∞—Ä—Ç–µ.</div>";
                    }
                });
        } else {
            document.body.innerHTML = "<div style='padding:40px; font-size:28px; text-align:center;'>‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è Telegram.<br>–û—Ç–∫—Ä–æ–π—Ç–µ –∫–∞—Ä—Ç—É –∏–∑ Telegram Mini App.</div>";
        }

        const debugBox = document.createElement('div');
        debugBox.style = "position:fixed; top:0; left:0; width:100%; max-height:60vh; overflow:auto; background:white; color:black; z-index:9999; font-size:14px; padding:20px;";
        debugBox.innerText = "tg.initData: " + (tg?.initData || "–Ω–µ—Ç") + "
user.id: " + userId;
        document.body.prepend(debugBox);
    }, 100);
</script>


<script>
    function parseTelegramInitData() {
        const tg = window.Telegram?.WebApp;
        const initDataStr = tg?.initData || "";
        const params = new URLSearchParams(initDataStr);
        const userRaw = params.get("user");
        if (userRaw) {
            try {
                const userObj = JSON.parse(userRaw);
                return userObj.id;
            } catch (e) {
                return null;
            }
        }
        return null;
    }

    setTimeout(() => {
        const tg = window.Telegram?.WebApp;
        const userId = tg?.initDataUnsafe?.user?.id || parseTelegramInitData();
        if (userId) {
            fetch(`https://nalchik-map-production.up.railway.app/check_access?user_id=${userId}`)
                .then(res => res.json())
                .then(data => {
                    if (!data.access) {
                        document.body.innerHTML = "<div style='padding:40px; font-size:28px; text-align:center;'>üîí <b>–î–æ—Å—Ç—É–ø –∑–∞–∫—Ä—ã—Ç</b><br><br>–ü–æ–¥–ø–∏—à–∏—Ç–µ—Å—å —á–µ—Ä–µ–∑ Telegram-–±–æ—Ç–∞, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –∫–∞—Ä—Ç–µ.</div>";
                    }
                });
        } else {
            document.body.innerHTML = "<div style='padding:40px; font-size:28px; text-align:center;'>‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è Telegram.<br>–û—Ç–∫—Ä–æ–π—Ç–µ –∫–∞—Ä—Ç—É –∏–∑ Telegram Mini App.</div>";
        }

        const debugBox = document.createElement('div');
        debugBox.style = "position:fixed; top:0; left:0; width:100%; max-height:60vh; overflow:auto; background:white; color:black; z-index:9999; font-size:14px; padding:20px;";
        debugBox.innerText = "tg.initData: " + (tg?.initData || "–Ω–µ—Ç") + "
user.id: " + userId;
        document.body.prepend(debugBox);
    }, 100);
</script>

</body>


</html>

