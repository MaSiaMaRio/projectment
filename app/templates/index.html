<!DOCTYPE html>
<html>
<head>
    <title>–ö–∞—Ä—Ç–∞ –ù–∞–ª—å—á–∏–∫–∞</title>
    <meta charset="utf-8" />
    <style>
        #map { height: 90vh; width: 100%; }
.marker-icon {
    background-color: #2563eb;
    border-radius: 50%;
    width: 60%;
    height: 60%;
    border: 10px solid white;
    box-shadow: 0 0 4px rgba(0,0,0,0.4);
    transition: transform 0.2s;
  }
        .leaflet-tooltip {
  font-size: 16px;        /* —Ä–∞–∑–º–µ—Ä —Ç–µ–∫—Å—Ç–∞ */
  padding: 6px 10px;      /* –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –æ—Ç—Å—Ç—É–ø—ã */
  background-color: #fff; /* —Ü–≤–µ—Ç —Ñ–æ–Ω–∞ */
  border-radius: 8px;     /* —Å–∫—Ä—É–≥–ª–µ–Ω–∏–µ —É–≥–ª–æ–≤ */
  border: 1px solid #ccc;
  box-shadow: 0 2px 6px rgba(0,0,0,0.15);
  font-weight: 500;
}

        .comment-box { margin-top: 100px; }
        .comment-input { width: 100%; padding: 40px; }
        .comment-list { margin-top: 50px; font-size: 0.9em; color: #333; max-height: 150px; overflow-y: auto; }
        .comment-item { border-top: 10px solid #ccc; padding: 30px 0; }
    </style>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
</head>
<body>
    <div id="map"></div>
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script>
        const map = L.map('map').setView([43.4847, 43.6071], 13);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; OpenStreetMap contributors'
        }).addTo(map);

        fetch('/get_points').then(res => res.json()).then(data => {
            data.forEach(p => {
                const marker = L.marker([p[1], p[2]], { icon: L.divIcon({ className: 'marker-icon', conSize: [100, 100] }) }).addTo(map);
                marker.bindTooltip(p[3], { permanent: true, direction: 'top' });

                let popupContent = `<b>${p[3]}</b><br/>Likes: ${p[5]} Dislikes: ${p[6]}<br/>`;
                if (p[4]) popupContent += `<img src="${p[4]}" width="100" /><br/>`;

                popupContent += `
                    <button onclick="like(${p[0]})">üëç</button>
                    <button onclick="dislike(${p[0]})">üëé</button>
                    
                `;

                marker.bindPopup(popupContent);

                marker.on('popupopen', () => {
                    loadComments(p[0]);
                });
            });
        });

        function like(id) {
            fetch('/like_point/' + id, { method: 'POST' }).then(() => location.reload());
        }

        function dislike(id) {
            fetch('/dislike_point/' + id, { method: 'POST' }).then(() => location.reload());
        }

        
map.on("zoom", () => {
  const zoom = map.getZoom();
  const scale = 0.8 + (zoom - 13) * 0.8;
  document.querySelectorAll(".marker-icon").forEach(el => {
    el.style.transform = `scale(${scale})`;
  });
});


    map.on('click', function(e) {
            const comment = prompt('–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ —Ç–æ—á–∫–µ:');
            if (!comment) return;
            const lat = e.latlng.lat;
            const lon = e.latlng.lng;
            const formData = new FormData();
            formData.append('lat', lat);
            formData.append('lon', lon);
            formData.append('comment', comment);
            const fileInput = document.createElement('input');
            fileInput.type = 'file';
            fileInput.accept = 'image/*';
            fileInput.onchange = () => {
                if (fileInput.files[0]) {
                    formData.append('image', fileInput.files[0]);
                }
                fetch('/add_point', { method: 'POST', body: formData })
                    .then(() => location.reload());
            };
            fileInput.click();
        });
    </script>
</body>
</html>

